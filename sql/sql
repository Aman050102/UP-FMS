CREATE DATABASE sports CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE sports.checkins (
  id           BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  ts           DATETIME        NOT NULL,
  session_date DATE            NOT NULL,
  facility     ENUM('outdoor','badminton','pool','track') NOT NULL,
  student_id   VARCHAR(32)     NOT NULL,
  name_full    VARCHAR(200)    NULL,
  faculty      VARCHAR(200)    NULL,
  email        VARCHAR(200)    NULL,
  ip_address   VARCHAR(64)     NULL,
  user_agent   TEXT            NULL,
  nonce        CHAR(36)        NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY uq_nonce (nonce),
  KEY idx_session_facility (session_date, facility),
  KEY idx_student_session (student_id, session_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

SELECT ts, facility, student_id, name_full, faculty, email
FROM checkins
WHERE session_date = CURDATE()
ORDER BY ts DESC
LIMIT 50;